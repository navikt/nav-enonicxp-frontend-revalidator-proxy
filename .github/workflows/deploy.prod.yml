name: Deploy to prod
on:
  release:
    types: [released]

jobs:
  build-and-deploy:
    if: github.event.release.target_commitish == 'master'
    uses: ./.github/workflows/build-and-deploy.yml
    with:
      environment: prod-gcp
      imagename: prod-deploy
      ingress: https://nav-enonicxp-frontend-revalidator-proxy.intern.nav.no
      appName: nav-enonicxp-frontend-revalidator-proxy
      frontendAppName: nav-enonicxp-frontend
      cluster: prod-gcp
    secrets:
      SERVICE_SECRET: ${{ secrets.SERVICE_SECRET }}
      NAIS_DEPLOY_APIKEY: ${{ secrets.NAIS_DEPLOY_APIKEY }}
